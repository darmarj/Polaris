
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="One branded static site from a set of Markdown files to host the documentation for Open Source or Commercial project">
      
      
      
      
      <link rel="icon" href="../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-7.3.6">
    
    
      
        <title>Proxmox - POLARIS</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.03d4cea5.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    
      


    
    
  <link rel="stylesheet" href="../../../overrides/assets/stylesheets/main.bf3dc0a9.min.css">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-deploy-vms-in-proxmox-with-terraform" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner md-announce">
          <div class="md-banner__inner md-announce__inner md-grid md-typeset">
            
  <a href="https://github.com/darmarj">
    For updates follow <strong>NEWs</strong> on
    <span class="twemoji twitter">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </span>
    <strong>Github</strong>
  </a>

          </div>
        </aside>
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="POLARIS" class="md-header__button md-logo" aria-label="POLARIS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            POLARIS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Proxmox
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
          
            <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/darmarj" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    darmarj
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../Container/containerd/" class="md-tabs__link md-tabs__link--active">
        DevOps
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../Linux/Network/NetCat/" class="md-tabs__link">
        GNU/Linux
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../blog/" class="md-tabs__link">
        Blog
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="POLARIS" class="md-nav__button md-logo" aria-label="POLARIS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    POLARIS
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/darmarj" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    darmarj
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          DevOps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DevOps" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          DevOps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Container Runtime
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Container Runtime" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Container Runtime
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Container/containerd/" class="md-nav__link">
        Containerd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker/docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Container/namespace/" class="md-nav__link">
        Namespace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Container/cgroups/" class="md-nav__link">
        Cgroups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Container/nerdctl/" class="md-nav__link">
        Nerdctl
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Terraform
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Terraform" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Terraform
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../KVM/" class="md-nav__link">
        KVM
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Proxmox
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Proxmox
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-terraform" class="md-nav__link">
    Install Terraform
  </a>
  
    <nav class="md-nav" aria-label="Install Terraform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determine-authentication-method-use-api-keys" class="md-nav__link">
    Determine Authentication Method (use API keys)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-basic-information-and-provider-installation" class="md-nav__link">
    Terraform basic information and provider installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#develop-terraform-plan" class="md-nav__link">
    Develop Terraform plan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-plan-official-term-for-what-will-terraform-do-next" class="md-nav__link">
    Terraform plan (official term for “what will Terraform do next”)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execute-the-terraform-plan-and-watch-the-vms-appear" class="md-nav__link">
    Execute the Terraform plan and watch the VMs appear!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-the-test-vm" class="md-nav__link">
    Removing the test VM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Rancher
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Rancher" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Rancher
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Rancher/K3s/" class="md-nav__link">
        K3s
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_4">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Kubernetes/architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Kubernetes/kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          GNU/Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GNU/Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          GNU/Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Network/NetCat/" class="md-nav__link">
        Network
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Distro
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Distro" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Distro
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_1" type="checkbox" id="__nav_3_2_1" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2_1">
          Gentoo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Gentoo" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_1">
          <span class="md-nav__icon md-icon"></span>
          Gentoo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_1_1" type="checkbox" id="__nav_3_2_1_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2_1_1">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_2_1_1">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Media/" class="md-nav__link">
        Media
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Network/" class="md-nav__link">
        Network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Prepare%20the%20disks/" class="md-nav__link">
        Prepare the disks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Stage3/" class="md-nav__link">
        Stage3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Base%20system/" class="md-nav__link">
        Base system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Kernel/" class="md-nav__link">
        Kernel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/System/" class="md-nav__link">
        System
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Tools/" class="md-nav__link">
        Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Gentoo/Bootloader/" class="md-nav__link">
        Bootloader
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../blog/">Blog</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Blog" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          2021
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2021" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          2021
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2021/11/CNCF-Containerd/CNCF-Containerd/" class="md-nav__link">
        Cloud Native-Containerd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2021/12/Proxmox/Proxmox-Source/" class="md-nav__link">
        Proxmox v8 Source in PandaWorld
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2021/12/Proxmox/Proxmox-Subscript/" class="md-nav__link">
        Proxmox v7 Subscription
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3">
          2022
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2022" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          2022
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2022/01/Hello%20Rocky/" class="md-nav__link">
        Rocky Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2022/01/Bitwarden/" class="md-nav__link">
        vaultBitwarden
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2022/02/HomePage/" class="md-nav__link">
        HomePage on React+Next
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2022/03/Terraform%2BKVM/" class="md-nav__link">
        Terraform works on KVM for IaaS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2022/03/Transparent%20Gnome/" class="md-nav__link">
        Transparent Gnome Shell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2022/03/KVM%20Bridge/" class="md-nav__link">
        KVM Bridge
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2022/03/ibus-flypyInput/" class="md-nav__link">
        iBus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2022/06/Groff%20%26%20MOM/" class="md-nav__link">
        Groff & MOM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4">
          2023
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2023" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          2023
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2023/05/OpenWRT/" class="md-nav__link">
        OpenWRT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2023/06/SubEditor/" class="md-nav__link">
        SublimE (Unlimited) for Linux User
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2023/06/Secret-store/" class="md-nav__link">
        Secure-store
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2023/06/TmuxReference/" class="md-nav__link">
        Tmux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2023/09/Vagrant/" class="md-nav__link">
        Vagrant Plugin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2023/12/Proxmox-disk-cleanup/" class="md-nav__link">
        Proxmox disk cleanup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-terraform" class="md-nav__link">
    Install Terraform
  </a>
  
    <nav class="md-nav" aria-label="Install Terraform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determine-authentication-method-use-api-keys" class="md-nav__link">
    Determine Authentication Method (use API keys)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-basic-information-and-provider-installation" class="md-nav__link">
    Terraform basic information and provider installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#develop-terraform-plan" class="md-nav__link">
    Develop Terraform plan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-plan-official-term-for-what-will-terraform-do-next" class="md-nav__link">
    Terraform plan (official term for “what will Terraform do next”)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execute-the-terraform-plan-and-watch-the-vms-appear" class="md-nav__link">
    Execute the Terraform plan and watch the VMs appear!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-the-test-vm" class="md-nav__link">
    Removing the test VM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="how-to-deploy-vms-in-proxmox-with-terraform">How to deploy VMs in Proxmox with Terraform<a class="headerlink" href="#how-to-deploy-vms-in-proxmox-with-terraform" title="Permanent link">&para;</a></h1>
<h2 id="background">Background<a class="headerlink" href="#background" title="Permanent link">&para;</a></h2>
<p>I’d like to learn Kubernetes and DevOps. A Kubernetes cluster requires at least 3 VMs/bare metal machines. In my last post, I wrote about <a href="https://austinsnerdythings.com/2021/08/30/how-to-create-a-proxmox-ubuntu-cloud-init-image/">how to create a Ubuntu cloud-init template for Proxmox</a>. In this post, we’ll take that template and use it to deploy a couple VMs via automation using Terraform. If you don’t have a template, you need one before proceeding.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<ol>
<li>Install Terraform</li>
<li>Determine authentication method for Terraform to interact with Proxmox (user/pass vs API keys)</li>
<li>Terraform basic initialization and provider installation</li>
<li>Develop Terraform plan</li>
<li>Terraform plan</li>
<li>Run Terraform plan and watch the VMs appear!</li>
</ol>
<h2 id="install-terraform">Install Terraform<a class="headerlink" href="#install-terraform" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
sudo<span class="w"> </span>apt-add-repository<span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2">] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>terraform
</code></pre></div>
<h3 id="determine-authentication-method-use-api-keys">Determine Authentication Method (use API keys)<a class="headerlink" href="#determine-authentication-method-use-api-keys" title="Permanent link">&para;</a></h3>
<p>You have two options here:</p>
<ul>
<li><strong>Username/password</strong> – you can use the existing default root user and root password here to make things easy… or</li>
<li><strong>API keys</strong> – this involves setting up a new user, giving that new user the required permissions, and then setting up API keys so that user doesn’t have to type in a password to perform actions</li>
</ul>
<p>I went with the API key method since it is not desirable to have your root password sitting in Terraform files (even as an environment variable isn’t a great idea). I didn’t really know what I was doing and I basically gave the new user full admin permissions anyways. Should I lock it down? Surely. Do I know what the minimum required permissions are to do so? Nope. If someone in the comments or on Reddit could enlighten me, I’d really appreciate it!</p>
<p>So we need to create a new user. We’ll name it ‘blog_example’. To add a new user go to Datacenter in the left tab, then Permissions -&gt; Users -&gt; Click add, name the user and click add.</p>
<p><img alt="Add_user" src="../../../assets/images/Add_user.png" title="Add_user" />
<code>Adding ‘blog_example’ user to my proxmox datacenter (cluster)</code></p>
<p>Next, we need to add API tokens. Click API tokens below users in the permissions category and click add. Select the user you just created and give the token an ID, and uncheck privilege separation (which means we want the token to have the same permissions as the user):</p>
<p><img alt="Add_user" src="../../../assets/images/Add_token.png" title="Add_token" />
<code>Adding a new API token for user ‘blog_example’</code></p>
<p><strong>When you click Add it will show you the key. Save this key. It will never be displayed again!</strong></p>
<p><img alt="Add_user" src="../../../assets/images/Token_secret.png" title="Token_secret" />
<code>Super secret API key secret</code></p>
<p>Next we need to add a role to the new user. Permissions -&gt; Add -&gt; Path = ‘/’, User is the one you just made, role = ‘PVEVMAdmin’. This gives the user (and associated API token!) rights to all nodes (the / for path) to do VMAdmin activities:</p>
<p><img alt="Add_user" src="../../../assets/images/User_Permission.png" title="User_Permission" /></p>
<p>You also need to add permissions to the storage used by the VMs you want to deploy (both from and to), for me this is /storage/local-zfs (might be /storage/local-lvm for you). Add that too in the path section. Use Admin for the role here because the user also needs the ability to allocate space in the datastore (you could use PVEVMAdmin + a datastore role but I haven’t dove into which one yet):</p>
<p><img alt="Add_user" src="../../../assets/images/Storage_Permission.png" title="Storage_Permission" /></p>
<p>At this point we are done with the permissions:</p>
<p><img alt="Add_user" src="../../../assets/images/Permission_Overview.png" title="Permission_Overview" /></p>
<h3 id="terraform-basic-information-and-provider-installation">Terraform basic information and provider installation<a class="headerlink" href="#terraform-basic-information-and-provider-installation" title="Permanent link">&para;</a></h3>
<p>Terraform has three main stages: init, plan, and apply. We will start with describing the plans, which can be thought of a a type of configuration file for what you want to do. Plans are files stored in directories. Make a new directory (terraform-blog), and create two files: main.tf and vars.tf:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~
mkdir<span class="w"> </span>terraform-blog<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>terraform-blog
touch<span class="w"> </span>main.tf<span class="w"> </span>vars.tf
</code></pre></div>
<p>The two files are hopefully reasonably named. The main content will be in main.tf and we will put a few variables in vars.tf. Everything could go in main.tf but it is a good practice to start splitting things out early. I actually don’t have as much in vars.tf as I should but we all gotta start somewhere</p>
<p>Ok so in main.tf let’s add the bare minimum. We need to tell Terraform to use a provider, which is the term they use for the connector to the entity Terraform will be interacting with. Since we are using Proxmox, we need to use a Proxmox provider. This is actually super easy – we just need to specify the name and version and Terraform goes out and grabs it from github and installs it. I used the <a href="https://github.com/Telmate/terraform-provider-proxmox">Telmate Proxmox provider</a>.</p>
<p>main.tf:</p>
<div class="highlight"><pre><span></span><code><span class="kc">terraf</span><span class="err">orm</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">required_providers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">proxmox</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">source</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;telmate/proxmox&quot;</span>
<span class="w">      </span><span class="err">versio</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;2.7.4&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Save the file. Now we’ll initialize Terraform with our barebones plan (terraform init), which will force it to go out and grab the provider. If all goes well, we will be informed that the provider was installed and that Terraform has been initialized. Terraform is also really nice in that it tells you the next step towards the bottom of the output (“try running ‘terraform plan’ next”).</p>
<div class="highlight"><pre><span></span><code>austin@EARTH:/mnt/c/Users/Austin/terraform-blog$ terraform init

Initializing the backend...

Initializing provider plugins...
- Finding telmate/proxmox versions matching &quot;2.7.4&quot;...
- Installing telmate/proxmox v2.7.4...
- Installed telmate/proxmox v2.7.4 (self-signed, key ID A9EBBE091B35AFCE)

Partner and community providers are signed by their developers.
If you&#39;d like to know more about provider signing, you can read about it here:
https://www.terraform.io/docs/cli/plugins/signing.html

Terraform has created a lock file .terraform.lock.hcl to record the provider
selections it made above. Include this file in your version control repository
so that Terraform can guarantee to make the same selections by default when
you run &quot;terraform init&quot; in the future.

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
</code></pre></div>
<h3 id="develop-terraform-plan">Develop Terraform plan<a class="headerlink" href="#develop-terraform-plan" title="Permanent link">&para;</a></h3>
<p>Alright with the provider installed, it is time to use it to deploy a VM. We will use the template as below. Alter your main.tf file to be the following. I break it down inside the file with comments</p>
<div class="highlight"><pre><span></span><code><span class="kc">terraf</span><span class="err">orm</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">required_providers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">proxmox</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">source</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;telmate/proxmox&quot;</span>
<span class="w">      </span><span class="err">versio</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;2.7.4&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">provider</span><span class="w"> </span><span class="s2">&quot;proxmox&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">url</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">hos</span><span class="kc">tna</span><span class="err">me</span><span class="w"> </span><span class="err">(FQDN</span><span class="w"> </span><span class="err">i</span><span class="kc">f</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">o</span><span class="kc">ne</span><span class="err">)</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">proxmox</span><span class="w"> </span><span class="err">hos</span><span class="kc">t</span><span class="w"> </span><span class="err">you&#39;d</span><span class="w"> </span><span class="err">like</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">co</span><span class="kc">nne</span><span class="err">c</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">issue</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">comma</span><span class="kc">n</span><span class="err">ds.</span><span class="w"> </span><span class="err">my</span><span class="w"> </span><span class="err">proxmox</span><span class="w"> </span><span class="err">hos</span><span class="kc">t</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">&#39;prox</span><span class="mi">-1</span><span class="err">u&#39;.</span><span class="w"> </span><span class="err">Add</span><span class="w"> </span><span class="err">/api</span><span class="mi">2</span><span class="err">/jso</span><span class="kc">n</span><span class="w"> </span><span class="err">a</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">API</span>
<span class="w">  </span><span class="err">pm_api_url</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;https://prox-1u:8006/api2/json&quot;</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">api</span><span class="w"> </span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="w"> </span><span class="err">id</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="kc">f</span><span class="err">orm</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;user</span><span class="kc">na</span><span class="err">me&gt;@pam!&lt;</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">Id&gt;</span>
<span class="w">  </span><span class="err">pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;blog_example@pam!new_token_id&quot;</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="kc">full</span><span class="w"> </span><span class="err">secre</span><span class="kc">t</span><span class="w"> </span><span class="err">wrapped</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="err">quo</span><span class="kc">tes</span><span class="err">.</span><span class="w"> </span><span class="err">do</span><span class="kc">n</span><span class="err">&#39;</span><span class="kc">t</span><span class="w"> </span><span class="err">worry</span><span class="p">,</span><span class="w"> </span><span class="err">I&#39;ve</span><span class="w"> </span><span class="err">already</span><span class="w"> </span><span class="err">dele</span><span class="kc">te</span><span class="err">d</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="kc">fr</span><span class="err">om</span><span class="w"> </span><span class="err">my</span><span class="w"> </span><span class="err">proxmox</span><span class="w"> </span><span class="err">clus</span><span class="kc">ter</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="kc">t</span><span class="err">ime</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">read</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">pos</span><span class="kc">t</span>
<span class="w">  </span><span class="err">pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_secre</span><span class="kc">t</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;9ec8e608-d834-4ce5-91d2-15dd59f9a8c1&quot;</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">leave</span><span class="w"> </span><span class="kc">tls</span><span class="err">_i</span><span class="kc">nse</span><span class="err">cure</span><span class="w"> </span><span class="err">se</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="err">u</span><span class="kc">nless</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">proxmox</span><span class="w"> </span><span class="err">SSL</span><span class="w"> </span><span class="err">cer</span><span class="kc">t</span><span class="err">i</span><span class="kc">f</span><span class="err">ica</span><span class="kc">te</span><span class="w"> </span><span class="err">si</span><span class="kc">tuat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="kc">full</span><span class="err">y</span><span class="w"> </span><span class="err">sor</span><span class="kc">te</span><span class="err">d</span><span class="w"> </span><span class="err">ou</span><span class="kc">t</span><span class="w"> </span><span class="err">(i</span><span class="kc">f</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">do</span><span class="p">,</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">k</span><span class="kc">n</span><span class="err">ow)</span>
<span class="w">  </span><span class="err">pm_</span><span class="kc">tls</span><span class="err">_i</span><span class="kc">nse</span><span class="err">cure</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>

<span class="err">#</span><span class="w"> </span><span class="err">resource</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="kc">f</span><span class="err">orma</span><span class="kc">tte</span><span class="err">d</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="s2">&quot;[type]&quot;</span><span class="w"> </span><span class="s2">&quot;[entity_name]&quot;</span><span class="w"> </span><span class="err">so</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">case</span>
<span class="err">#</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">looki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">crea</span><span class="kc">te</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">proxmox_vm_qemu</span><span class="w"> </span><span class="err">e</span><span class="kc">nt</span><span class="err">i</span><span class="kc">t</span><span class="err">y</span><span class="w"> </span><span class="kc">na</span><span class="err">med</span><span class="w"> </span><span class="kc">test</span><span class="err">_server</span>
<span class="err">resource</span><span class="w"> </span><span class="s2">&quot;proxmox_vm_qemu&quot;</span><span class="w"> </span><span class="s2">&quot;test_server&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">cou</span><span class="kc">nt</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">jus</span><span class="kc">t</span><span class="w"> </span><span class="err">wa</span><span class="kc">nt</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="kc">n</span><span class="err">ow</span><span class="p">,</span><span class="w"> </span><span class="err">se</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">apply</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">des</span><span class="kc">tr</span><span class="err">oy</span><span class="w"> </span><span class="err">VM</span>
<span class="w">  </span><span class="kc">na</span><span class="err">me</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;test-vm-${count.index + 1}&quot;</span><span class="w"> </span><span class="err">#cou</span><span class="kc">nt</span><span class="err">.i</span><span class="kc">n</span><span class="err">dex</span><span class="w"> </span><span class="err">s</span><span class="kc">tarts</span><span class="w"> </span><span class="err">a</span><span class="kc">t</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">so</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">mea</span><span class="kc">ns</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">VM</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="kc">na</span><span class="err">med</span><span class="w"> </span><span class="kc">test</span><span class="mi">-</span><span class="err">vm</span><span class="mi">-1</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="err">proxmox</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="kc">n</span><span class="err">ow</span><span class="w"> </span><span class="err">reaches</span><span class="w"> </span><span class="err">ou</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">vars</span><span class="w"> </span><span class="kc">f</span><span class="err">ile.</span><span class="w"> </span><span class="err">I</span><span class="w"> </span><span class="err">could&#39;ve</span><span class="w"> </span><span class="err">also</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">var</span><span class="w"> </span><span class="err">above</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">pm_api_url</span><span class="w"> </span><span class="err">se</span><span class="kc">tt</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">bu</span><span class="kc">t</span><span class="w"> </span><span class="err">wa</span><span class="kc">nte</span><span class="err">d</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">spell</span><span class="w"> </span><span class="err">i</span><span class="kc">t</span><span class="w"> </span><span class="err">ou</span><span class="kc">t</span><span class="w"> </span><span class="err">up</span><span class="w"> </span><span class="kc">t</span><span class="err">here.</span><span class="w"> </span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">_</span><span class="kc">n</span><span class="err">ode</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">di</span><span class="kc">fferent</span><span class="w"> </span><span class="kc">t</span><span class="err">ha</span><span class="kc">n</span><span class="w"> </span><span class="err">api_url.</span><span class="w"> </span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">_</span><span class="kc">n</span><span class="err">ode</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">which</span><span class="w"> </span><span class="kc">n</span><span class="err">ode</span><span class="w"> </span><span class="err">hos</span><span class="kc">ts</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="kc">te</span><span class="err">mpla</span><span class="kc">te</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="kc">t</span><span class="err">hus</span><span class="w"> </span><span class="err">also</span><span class="w"> </span><span class="err">which</span><span class="w"> </span><span class="kc">n</span><span class="err">ode</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">hos</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="kc">ne</span><span class="err">w</span><span class="w"> </span><span class="err">VM.</span><span class="w"> </span><span class="err">i</span><span class="kc">t</span><span class="w"> </span><span class="err">ca</span><span class="kc">n</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">di</span><span class="kc">fferent</span><span class="w"> </span><span class="kc">t</span><span class="err">ha</span><span class="kc">n</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">hos</span><span class="kc">t</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">commu</span><span class="kc">n</span><span class="err">ica</span><span class="kc">te</span><span class="w"> </span><span class="err">wi</span><span class="kc">t</span><span class="err">h</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">API.</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">variable</span><span class="w"> </span><span class="err">co</span><span class="kc">nta</span><span class="err">i</span><span class="kc">ns</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">co</span><span class="kc">ntents</span><span class="w"> </span><span class="s2">&quot;prox-1u&quot;</span>
<span class="w">  </span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">_</span><span class="kc">n</span><span class="err">ode</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">var.proxmox_hos</span><span class="kc">t</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">o</span><span class="kc">t</span><span class="err">her</span><span class="w"> </span><span class="err">variable</span><span class="w"> </span><span class="err">wi</span><span class="kc">t</span><span class="err">h</span><span class="w"> </span><span class="err">co</span><span class="kc">ntents</span><span class="w"> </span><span class="s2">&quot;ubuntu-2004-cloudinit-template&quot;</span>
<span class="w">  </span><span class="err">clo</span><span class="kc">ne</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">var.</span><span class="kc">te</span><span class="err">mpla</span><span class="kc">te</span><span class="err">_</span><span class="kc">na</span><span class="err">me</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">basic</span><span class="w"> </span><span class="err">VM</span><span class="w"> </span><span class="err">se</span><span class="kc">tt</span><span class="err">i</span><span class="kc">n</span><span class="err">gs</span><span class="w"> </span><span class="err">here.</span><span class="w"> </span><span class="err">age</span><span class="kc">nt</span><span class="w"> </span><span class="err">re</span><span class="kc">fers</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">gues</span><span class="kc">t</span><span class="w"> </span><span class="err">age</span><span class="kc">nt</span>
<span class="w">  </span><span class="err">age</span><span class="kc">nt</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="err">os_</span><span class="kc">t</span><span class="err">ype</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;cloud-init&quot;</span>
<span class="w">  </span><span class="err">cores</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">  </span><span class="err">socke</span><span class="kc">ts</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="err">cpu</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;host&quot;</span>
<span class="w">  </span><span class="err">memory</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">2048</span>
<span class="w">  </span><span class="err">scsihw</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;virtio-scsi-pci&quot;</span>
<span class="w">  </span><span class="err">boo</span><span class="kc">t</span><span class="err">disk</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;scsi0&quot;</span>

<span class="w">  </span><span class="err">disk</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">slo</span><span class="kc">t</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="err">se</span><span class="kc">t</span><span class="w"> </span><span class="err">disk</span><span class="w"> </span><span class="err">size</span><span class="w"> </span><span class="err">here.</span><span class="w"> </span><span class="err">leave</span><span class="w"> </span><span class="err">i</span><span class="kc">t</span><span class="w"> </span><span class="err">small</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="kc">test</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">because</span><span class="w"> </span><span class="err">expa</span><span class="kc">n</span><span class="err">di</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">disk</span><span class="w"> </span><span class="kc">ta</span><span class="err">kes</span><span class="w"> </span><span class="kc">t</span><span class="err">ime.</span>
<span class="w">    </span><span class="err">size</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;10G&quot;</span>
<span class="w">    </span><span class="kc">t</span><span class="err">ype</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;scsi&quot;</span>
<span class="w">    </span><span class="err">s</span><span class="kc">t</span><span class="err">orage</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;local-zfs&quot;</span>
<span class="w">    </span><span class="err">io</span><span class="kc">t</span><span class="err">hread</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">i</span><span class="kc">f</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">wa</span><span class="kc">nt</span><span class="w"> </span><span class="kc">t</span><span class="err">wo</span><span class="w"> </span><span class="err">NICs</span><span class="p">,</span><span class="w"> </span><span class="err">jus</span><span class="kc">t</span><span class="w"> </span><span class="err">copy</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">whole</span><span class="w"> </span><span class="kc">net</span><span class="err">work</span><span class="w"> </span><span class="err">sec</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">duplica</span><span class="kc">te</span><span class="w"> </span><span class="err">i</span><span class="kc">t</span>
<span class="w">  </span><span class="kc">net</span><span class="err">work</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">model</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;virtio&quot;</span>
<span class="w">    </span><span class="err">bridge</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;vmbr0&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="kc">n</span><span class="err">o</span><span class="kc">t</span><span class="w"> </span><span class="err">sure</span><span class="w"> </span><span class="err">exac</span><span class="kc">tl</span><span class="err">y</span><span class="w"> </span><span class="err">wha</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="kc">f</span><span class="err">or.</span><span class="w"> </span><span class="err">presumably</span><span class="w"> </span><span class="err">some</span><span class="kc">t</span><span class="err">hi</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">abou</span><span class="kc">t</span><span class="w"> </span><span class="err">MAC</span><span class="w"> </span><span class="err">addresses</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">ig</span><span class="kc">n</span><span class="err">ore</span><span class="w"> </span><span class="kc">net</span><span class="err">work</span><span class="w"> </span><span class="err">cha</span><span class="kc">n</span><span class="err">ges</span><span class="w"> </span><span class="err">duri</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">li</span><span class="kc">fe</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">VM</span>
<span class="w">  </span><span class="err">li</span><span class="kc">fe</span><span class="err">cycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ore_cha</span><span class="kc">n</span><span class="err">ges</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="kc">net</span><span class="err">work</span><span class="p">,</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">$</span><span class="p">{</span><span class="err">cou</span><span class="kc">nt</span><span class="err">.i</span><span class="kc">n</span><span class="err">dex</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="kc">t</span><span class="err">hi</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">appe</span><span class="kc">n</span><span class="err">ds</span><span class="w"> </span><span class="kc">te</span><span class="err">x</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">ip</span><span class="w"> </span><span class="err">address</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">case</span><span class="p">,</span><span class="w"> </span><span class="err">si</span><span class="kc">n</span><span class="err">ce</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">o</span><span class="kc">nl</span><span class="err">y</span><span class="w"> </span><span class="err">addi</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">si</span><span class="kc">n</span><span class="err">gle</span><span class="w"> </span><span class="err">VM</span><span class="p">,</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">IP</span><span class="w"> </span><span class="err">will</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="mf">10.98.1.91</span><span class="w"> </span><span class="err">si</span><span class="kc">n</span><span class="err">ce</span><span class="w"> </span><span class="err">cou</span><span class="kc">nt</span><span class="err">.i</span><span class="kc">n</span><span class="err">dex</span><span class="w"> </span><span class="err">s</span><span class="kc">tarts</span><span class="w"> </span><span class="err">a</span><span class="kc">t</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="kc">t</span><span class="err">his</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">how</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">ca</span><span class="kc">n</span><span class="w"> </span><span class="err">crea</span><span class="kc">te</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">mul</span><span class="kc">t</span><span class="err">iple</span><span class="w"> </span><span class="err">VMs</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="w"> </span><span class="err">IP</span><span class="w"> </span><span class="err">assig</span><span class="kc">ne</span><span class="err">d</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">each</span><span class="w"> </span><span class="err">(.</span><span class="mi">91</span><span class="p">,</span><span class="w"> </span><span class="err">.</span><span class="mi">92</span><span class="p">,</span><span class="w"> </span><span class="err">.</span><span class="mi">93</span><span class="p">,</span><span class="w"> </span><span class="err">e</span><span class="kc">t</span><span class="err">c.)</span>

<span class="w">  </span><span class="err">ipco</span><span class="kc">nf</span><span class="err">ig</span><span class="mi">0</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;ip=10.98.1.9${count.index + 1}/24,gw=10.98.1.1&quot;</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="err">sshkeys</span><span class="w"> </span><span class="err">se</span><span class="kc">t</span><span class="w"> </span><span class="err">usi</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">variables.</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">variable</span><span class="w"> </span><span class="err">co</span><span class="kc">nta</span><span class="err">i</span><span class="kc">ns</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="kc">te</span><span class="err">x</span><span class="kc">t</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">key.</span>
<span class="w">  </span><span class="err">sshkeys</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">&lt;&lt;EOF</span>
<span class="w">  </span><span class="err">$</span><span class="p">{</span><span class="err">var.ssh_key</span><span class="p">}</span>
<span class="w">  </span><span class="err">EOF</span>
<span class="p">}</span>
</code></pre></div>
<p>There is a good amount going on in here. Hopefully the embedded comments explain everything. If not, let me know in the comments or on Reddit (u/Nerdy-Austin).</p>
<p>Now for the vars.tf file. This is a bit easier to understand. Just declare a variable, give it a name, and a default value. That’s all I know at this point and it works.</p>
<div class="highlight"><pre><span></span><code><span class="err">variable</span><span class="w"> </span><span class="s2">&quot;ssh_key&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">de</span><span class="kc">fault</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDcwZAOfqf6E6p8IkrurF2vR3NccPbMlXFPaFe2+Eh/8QnQCJVTL6PKduXjXynuLziC9cubXIDzQA+4OpFYUV2u0fAkXLOXRIwgEmOrnsGAqJTqIsMC3XwGRhR9M84c4XPAX5sYpOsvZX/qwFE95GAdExCUkS3H39rpmSCnZG9AY4nPsVRlIIDP+/6YSy9KWp2YVYe5bDaMKRtwKSq3EOUhl3Mm8Ykzd35Z0Cysgm2hR2poN+EB7GD67fyi+6ohpdJHVhinHi7cQI4DUp+37nVZG4ofYFL9yRdULlHcFa9MocESvFVlVW0FCvwFKXDty6askpg9yf4FnM0OSbhgqXzD austin@EARTH&quot;</span>
<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;proxmox_host&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">de</span><span class="kc">fault</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;prox-1u&quot;</span>
<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;template_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">de</span><span class="kc">fault</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;ubuntu-2004-cloudinit-template&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="terraform-plan-official-term-for-what-will-terraform-do-next">Terraform plan (official term for “what will Terraform do next”)<a class="headerlink" href="#terraform-plan-official-term-for-what-will-terraform-do-next" title="Permanent link">&para;</a></h3>
<p>Now with the .tf files completed, we can run the plan (terraform plan). We defined a count=1 resource, so we would expect Terraform to create a single VM. Let’s have Terraform run through the plan and tell us what it intends to do. It tells us a lot.</p>
<div class="highlight"><pre><span></span><code><span class="err">austin@EARTH</span><span class="p">:</span><span class="err">/mnt/c/Users/Austin/terraform-blog$</span><span class="w"> </span><span class="err">terraform</span><span class="w"> </span><span class="err">plan</span>

<span class="err">Terraform</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">selected</span><span class="w"> </span><span class="err">providers</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">generate</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">following</span><span class="w"> </span><span class="err">execution</span><span class="w"> </span><span class="err">plan</span><span class="p">.</span><span class="w"> </span><span class="err">Resource</span><span class="w"> </span><span class="err">actions</span>
<span class="err">are</span><span class="w"> </span><span class="err">indicated</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">following</span><span class="w"> </span><span class="err">symbols</span><span class="p">:</span>
<span class="w">  </span><span class="err">+</span><span class="w"> </span><span class="err">create</span>

<span class="err">Terraform</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">perform</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">following</span><span class="w"> </span><span class="err">actions</span><span class="p">:</span>

<span class="c1">  # proxmox_vm_qemu.test_server[0] will be created</span>
<span class="w">  </span><span class="err">+</span><span class="w"> </span><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;proxmox_vm_qemu&quot;</span><span class="w"> </span><span class="nv">&quot;test_server&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">additional_wait</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">15</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">agent</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">balloon</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">bios</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;seabios&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">boot</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cdn&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">bootdisk</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;scsi0&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">clone</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ubuntu-2004-cloudinit-template&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">clone_wait</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">15</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">cores</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">cpu</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;host&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">default_ipv4_address</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">define_connection_info</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">force_create</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">full_clone</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">guest_agent_ready_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">hotplug</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;network,disk,usb&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">id</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">ipconfig0</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ip=10.98.1.91/24,gw=10.98.1.1&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">kvm</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">memory</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="m">2048</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">name</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test-vm-1&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">nameserver</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">numa</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">onboot</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">os_type</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloud-init&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">preprovision</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">reboot_required</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">scsihw</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;virtio-scsi-pci&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">searchdomain</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">sockets</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">ssh_host</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">ssh_port</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">sshkeys</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="dl">EOT</span>
<span class="sh">              ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDcwZAOfqf6E6p8IkrurF2vR3NccPbMlXFPaFe2+Eh/8QnQCJVTL6PKduXjXynuLziC9cubXIDzQA+4OpFYUV2u0fAkXLOXRIwgEmOrnsGAqJTqIsMC3XwGRhR9M84c4XPAX5sYpOsvZX/qwFE95GAdExCUkS3H39rpmSCnZG9AY4nPsVRlIIDP+/6YSy9KWp2YVYe5bDaMKRtwKSq3EOUhl3Mm8Ykzd35Z0Cysgm2hR2poN+EB7GD67fyi+6ohpdJHVhinHi7cQI4DUp+37nVZG4ofYFL9yRdULlHcFa9MocESvFVlVW0FCvwFKXDty6askpg9yf4FnM0OSbhgqXzD austin@EARTH</span>
<span class="dl">        EOT</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">target_node</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prox-1u&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">unused_disk</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">vcpus</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">vlan</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="err">-</span><span class="m">1</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">vmid</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>

<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="nb">disk</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">backup</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">cache</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">file</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">format</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">iothread</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps_rd</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps_rd_max</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps_wr</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps_wr_max</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">media</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">replicate</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">size</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10G&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">slot</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">ssd</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">storage</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;local-zfs&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">storage_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;scsi&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">volume</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="nb">network</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">bridge</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vmbr0&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">firewall</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">link_down</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">macaddr</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">model</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;virtio&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">queues</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">rate</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">tag</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="err">-</span><span class="m">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="err">Plan</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">add</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">change</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">destroy</span><span class="p">.</span>

<span class="err">────────────────────────────────────────────────────────────────────────────────────────────────</span>

<span class="err">Note</span><span class="p">:</span><span class="w"> </span><span class="err">You</span><span class="w"> </span><span class="err">didn&#39;t</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">-out</span><span class="w"> </span><span class="err">option</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">save</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">plan</span><span class="p">,</span><span class="w"> </span><span class="err">so</span><span class="w"> </span><span class="err">Terraform</span><span class="w"> </span><span class="err">can&#39;t</span><span class="w"> </span><span class="err">guarantee</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">take</span>
<span class="err">exactly</span><span class="w"> </span><span class="err">these</span><span class="w"> </span><span class="err">actions</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">run</span><span class="w"> </span><span class="s2">&quot;terraform apply&quot;</span><span class="w"> </span><span class="err">now</span><span class="p">.</span>
</code></pre></div>
<p>You can see the output of the planning phase of Terraform. It is telling us it will create proxmox_vm_qemu.test_server[0] with a list of parameters. You can double-check the IP address here, as well as the rest of the basic settings. At the bottom is the summary – “Plan: 1 to add, 0 to change, 0 to destroy.” Also note that it tells us again what step to run next – “terraform apply”.</p>
<h3 id="execute-the-terraform-plan-and-watch-the-vms-appear">Execute the Terraform plan and watch the VMs appear!<a class="headerlink" href="#execute-the-terraform-plan-and-watch-the-vms-appear" title="Permanent link">&para;</a></h3>
<p>With the summary stating what we want, we can now apply the plan (terraform apply). <strong>Note that it prompts you to type in ‘yes’ to apply the changes after it determines what the changes are</strong>. It typically takes 1m15s &plusmn; 15s for my VMs to get created.</p>
<p>If all goes well, you will be informed that 1 resource was added!</p>
<p><img alt="terraform apply" src="../../../assets/images/terraform%20apply.png" title="terraform apply" /></p>
<p>Command and full output:</p>
<div class="highlight"><pre><span></span><code><span class="err">austin@EARTH</span><span class="p">:</span><span class="err">/mnt/c/Users/Austin/terraform-blog$</span><span class="w"> </span><span class="err">terraform</span><span class="w"> </span><span class="err">apply</span>

<span class="err">Terraform</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">selected</span><span class="w"> </span><span class="err">providers</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">generate</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">following</span><span class="w"> </span><span class="err">execution</span><span class="w"> </span><span class="err">plan</span><span class="p">.</span><span class="w"> </span><span class="err">Resource</span><span class="w"> </span><span class="err">actions</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">indicated</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">following</span><span class="w"> </span><span class="err">symbols</span><span class="p">:</span>
<span class="w">  </span><span class="err">+</span><span class="w"> </span><span class="err">create</span>

<span class="err">Terraform</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">perform</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">following</span><span class="w"> </span><span class="err">actions</span><span class="p">:</span>

<span class="c1">  # proxmox_vm_qemu.test_server[0] will be created</span>
<span class="w">  </span><span class="err">+</span><span class="w"> </span><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;proxmox_vm_qemu&quot;</span><span class="w"> </span><span class="nv">&quot;test_server&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">additional_wait</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">15</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">agent</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">balloon</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">bios</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;seabios&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">boot</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cdn&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">bootdisk</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;scsi0&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">clone</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ubuntu-2004-cloudinit-template&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">clone_wait</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">15</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">cores</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">cpu</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;host&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">default_ipv4_address</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">define_connection_info</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">force_create</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">full_clone</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">guest_agent_ready_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">hotplug</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;network,disk,usb&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">id</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">ipconfig0</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ip=10.98.1.91/24,gw=10.98.1.1&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">kvm</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">memory</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="m">2048</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">name</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test-vm-1&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">nameserver</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">numa</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">onboot</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">os_type</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloud-init&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">preprovision</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">reboot_required</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">scsihw</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;virtio-scsi-pci&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">searchdomain</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">sockets</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">ssh_host</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">ssh_port</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">sshkeys</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="dl">EOT</span>
<span class="sh">              ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDcwZAOfqf6E6p8IkrurF2vR3NccPbMlXFPaFe2+Eh/8QnQCJVTL6PKduXjXynuLziC9cubXIDzQA+4OpFYUV2u0fAkXLOXRIwgEmOrnsGAqJTqIsMC3XwGRhR9M84c4XPAX5sYpOsvZX/qwFE95GAdExCUkS3H39rpmSCnZG9AY4nPsVRlIIDP+/6YSy9KWp2YVYe5bDaMKRtwKSq3EOUhl3Mm8Ykzd35Z0Cysgm2hR2poN+EB7GD67fyi+6ohpdJHVhinHi7cQI4DUp+37nVZG4ofYFL9yRdULlHcFa9MocESvFVlVW0FCvwFKXDty6askpg9yf4FnM0OSbhgqXzD austin@EARTH</span>
<span class="dl">        EOT</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">target_node</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prox-1u&quot;</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">unused_disk</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">vcpus</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">vlan</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="err">-</span><span class="m">1</span>
<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="na">vmid</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>

<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="nb">disk</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">backup</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">cache</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">file</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">format</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">iothread</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps_rd</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps_rd_max</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps_wr</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">mbps_wr_max</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">media</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">replicate</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">size</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10G&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">slot</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">ssd</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">storage</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;local-zfs&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">storage_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;scsi&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">volume</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">      </span><span class="err">+</span><span class="w"> </span><span class="nb">network</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">bridge</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vmbr0&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">firewall</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">link_down</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">macaddr</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">model</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;virtio&quot;</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">queues</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">rate</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">known</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">apply</span><span class="p">)</span>
<span class="w">          </span><span class="err">+</span><span class="w"> </span><span class="na">tag</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="err">-</span><span class="m">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="err">Plan</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">add</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">change</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">destroy</span><span class="p">.</span>

<span class="err">Do</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">want</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">perform</span><span class="w"> </span><span class="err">these</span><span class="w"> </span><span class="err">actions</span><span class="p">?</span>
<span class="w">  </span><span class="err">Terraform</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">perform</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">actions</span><span class="w"> </span><span class="err">described</span><span class="w"> </span><span class="err">above</span><span class="p">.</span>
<span class="w">  </span><span class="err">Only</span><span class="w"> </span><span class="err">&#39;yes&#39;</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">accepted</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">approve</span><span class="p">.</span>

<span class="w">  </span><span class="err">Enter</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">value</span><span class="p">:</span><span class="w"> </span><span class="err">yes</span>

<span class="nv">proxmox_vm_qemu.test_server[0</span><span class="p">]:</span><span class="w"> </span><span class="err">Creating</span><span class="p">...</span>
<span class="nv">proxmox_vm_qemu.test_server[0</span><span class="p">]:</span><span class="w"> </span><span class="err">Still</span><span class="w"> </span><span class="err">creating</span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="m">10</span><span class="err">s</span><span class="w"> </span><span class="err">elapsed</span><span class="p">]</span>
<span class="nv">proxmox_vm_qemu.test_server[0</span><span class="p">]:</span><span class="w"> </span><span class="err">Still</span><span class="w"> </span><span class="err">creating</span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="m">20</span><span class="err">s</span><span class="w"> </span><span class="err">elapsed</span><span class="p">]</span>
<span class="nv">proxmox_vm_qemu.test_server[0</span><span class="p">]:</span><span class="w"> </span><span class="err">Still</span><span class="w"> </span><span class="err">creating</span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="m">30</span><span class="err">s</span><span class="w"> </span><span class="err">elapsed</span><span class="p">]</span>
<span class="nv">proxmox_vm_qemu.test_server[0</span><span class="p">]:</span><span class="w"> </span><span class="err">Still</span><span class="w"> </span><span class="err">creating</span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="m">40</span><span class="err">s</span><span class="w"> </span><span class="err">elapsed</span><span class="p">]</span>
<span class="nv">proxmox_vm_qemu.test_server[0</span><span class="p">]:</span><span class="w"> </span><span class="err">Still</span><span class="w"> </span><span class="err">creating</span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="m">50</span><span class="err">s</span><span class="w"> </span><span class="err">elapsed</span><span class="p">]</span>
<span class="nv">proxmox_vm_qemu.test_server[0</span><span class="p">]:</span><span class="w"> </span><span class="err">Still</span><span class="w"> </span><span class="err">creating</span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="m">1</span><span class="err">m</span><span class="m">0</span><span class="err">s</span><span class="w"> </span><span class="err">elapsed</span><span class="p">]</span>
<span class="nv">proxmox_vm_qemu.test_server[0</span><span class="p">]:</span><span class="w"> </span><span class="err">Creation</span><span class="w"> </span><span class="err">complete</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="m">1</span><span class="err">m</span><span class="m">9</span><span class="err">s</span><span class="w"> </span><span class="p">[</span><span class="na">id</span><span class="o">=</span><span class="err">prox-</span><span class="m">1</span><span class="err">u/qemu/</span><span class="m">142</span><span class="p">]</span>

<span class="err">Apply</span><span class="w"> </span><span class="err">complete</span><span class="p">!</span><span class="w"> </span><span class="err">Resources</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">added</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">changed</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">destroyed</span><span class="p">.</span>
</code></pre></div>
<p>Now go check Proxmox and see if your VM was created:</p>
<p><img alt="PromoxVM" src="../../../assets/images/PromoxVM.png" title="PromoxVM" /></p>
<p>Success! You should now be able to SSH into the new VM with the key you already provided <strong>(note: the username will be ‘ubuntu’, not whatever you had set in your key)</strong>.</p>
<h3 id="removing-the-test-vm">Removing the test VM<a class="headerlink" href="#removing-the-test-vm" title="Permanent link">&para;</a></h3>
<p>I just set the count to 0 for the resource in the main.tf file and apply and the VM is stopped and destroyed.</p>
<div class="highlight"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;proxmox_vm_qemu&quot;</span><span class="w"> </span><span class="nv">&quot;test_server&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1"># just want 1 for now, set to 0 and apply to destroy</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>This felt like a quick-n-dirty tutorial for how to use Terraform to deploy virtual machines in Proxmox but looking back, there is a decent amount of detail. It took me quite a while to work through permission issues, hostnames being invalid (turns out you can’t have underscores (_) in hostnames, duh, that took an hour to find), assigning roles to users vs the associated API keys, etc. but I’m glad I worked through everything and can pass it along. Check back soon for my next post on <a href="https://austinsnerdythings.com/2021/09/23/deploying-kubernetes-vms-in-proxmox-with-terraform/">using Terraform to deploy a full set of Kubernetes machines to a Proxmox cluster</a> (and thrilling sequel to that post, Using Ansible to bootstrap a Kubernetes Cluster)!</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://austinsnerdythings.com/2021/09/01/how-to-deploy-vms-in-proxmox-with-terraform/">https://austinsnerdythings.com/2021/09/01/how-to-deploy-vms-in-proxmox-with-terraform/</a></li>
<li><a href="https://registry.terraform.io/providers/Telmate/proxmox/latest/docs">https://registry.terraform.io/providers/Telmate/proxmox/latest/docs</a></li>
<li><a href="https://vectops.com/2020/05/provision-proxmox-vms-with-terraform-quick-and-easy/">https://vectops.com/2020/05/provision-proxmox-vms-with-terraform-quick-and-easy/</a></li>
<li><a href="https://norocketscience.at/provision-proxmox-virtual-machines-with-terraform/">https://norocketscience.at/provision-proxmox-virtual-machines-with-terraform/</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../KVM/" class="md-footer__link md-footer__link--prev" aria-label="Previous: KVM" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              KVM
            </div>
          </div>
        </a>
      
      
        
        <a href="../../Rancher/K3s/" class="md-footer__link md-footer__link--next" aria-label="Next: K3s" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              K3s
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 ~ Present Darmarj.M
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/darmarj" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.action.view", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.8397ff9e.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script>
    
    
  
      <script src="../../../assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  <script src="../../../overrides/assets/javascripts/bundle.525231ca.min.js"></script>

  </body>
</html>